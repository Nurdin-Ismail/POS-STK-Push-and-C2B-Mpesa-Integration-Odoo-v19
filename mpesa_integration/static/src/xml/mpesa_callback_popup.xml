<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="mpesa_integration.MpesaCallbackPopup">
        <Dialog title="'Select M-Pesa Payment'" size="'lg'">
            <div class="mpesa-callback-popup">
                <!-- Info Banner -->
                <div class="alert alert-info mb-3">
                    <i class="fa fa-info-circle me-2"/>
                    Found <strong t-esc="props.callbacks.length"/> matching payment(s) for 
                    <strong>KES <t t-esc="props.amount.toFixed(2)"/></strong>
                </div>

                <!-- Callback List -->
                <div class="callback-list" style="max-height: 400px; overflow-y: auto;">
                    <t t-foreach="props.callbacks" t-as="callback" t-key="callback.id">
                        <div class="callback-card border rounded p-3 mb-3 cursor-pointer hover-shadow" 
                            t-on-click="() => this.onSelectCallback(callback)"
                            style="cursor: pointer; transition: all 0.2s;">
                            <div class="row">
                                <!-- Left Side - Customer Info -->
                                <div class="col-md-7">
                                    <h6 class="mb-2">
                                        <i class="fa fa-user text-primary me-2"/>
                                        <strong t-esc="callback.customer_name"/>
                                    </h6>
                                    <div class="text-muted small">
                                        <div class="mb-1">
                                            <i class="fa fa-phone me-2" style="width: 16px;"/>
                                            <t t-esc="this.formatPhone(callback.phone_number)"/>
                                        </div>
                                        <div class="mb-1">
                                            <i class="fa fa-receipt me-2" style="width: 16px;"/>
                                            <t t-esc="callback.mpesa_receipt_number"/>
                                        </div>
                                        <div class="mb-1">
                                            <i class="fa fa-clock-o me-2" style="width: 16px;"/>
                                            <t t-esc="this.formatDate(callback.create_date)"/>
                                        </div>
                                        <t t-if="callback.bill_ref_number">
                                            <div>
                                                <i class="fa fa-tag me-2" style="width: 16px;"/>
                                                Ref: <t t-esc="callback.bill_ref_number"/>
                                            </div>
                                        </t>
                                    </div>
                                </div>

                                <!-- Right Side - Amount & Action -->
                                <div class="col-md-5 text-end d-flex flex-column justify-content-between">
                                    <div>
                                        <h4 class="text-success mb-0">
                                            KES <t t-esc="callback.amount.toFixed(2)"/>
                                        </h4>
                                        <small class="text-muted">
                                            <t t-esc="callback.transaction_date"/>
                                        </small>
                                    </div>
                                    <button class="btn btn-primary btn-sm mt-2">
                                        <i class="fa fa-check me-1"/> Select Payment
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>

                <!-- Skip Button -->
                <div class="mt-3 pt-3 border-top">
                    <button class="btn btn-secondary w-100" t-on-click="() => this.onSkipReconciliation()">
                        <i class="fa fa-forward me-2"/>
                        Validate Without Matching Payment
                    </button>
                    <small class="text-muted d-block text-center mt-2">
                        Use this if the customer paid but the payment is not shown above
                    </small>
                </div>
            </div>
        </Dialog>
    </t>
</templates>